<div class="screen-container">
  <app-header [user]="currentUser" (logout)="onLogout()"></app-header>

  <div class="content-wrapper">
    <div class="balance-car">
      <div class="balance-container">
        <h2>Movimentar conta</h2>
        <div class="balance-amount">
          {{ currentUser?.saldo | currency:'BRL':'symbol':'1.2-2' }}
        </div>
        <div class="pix-key">Chave PIX: {{ currentUser?.chavePix }}</div>
      </div>
    </div>

    <div class="card transaction-card">
      <h3>Nova Transação</h3>

      @if (isTransactionSuccessful) {
        <div class="alert success-alert">
          <span>Transação realizada com sucesso!</span>
        </div>
      }

      @if (errorMessage) {
        <div class="alert error-alert">
          <span>{{ errorMessage }}</span>
        </div>
      }

      <section class="transaction-section">
        <h4>Tipo de operação</h4>
        <p class="section-helper">Escolha o que você deseja fazer agora.</p>
        <div class="transaction-type-grid">
          <button
            type="button"
            class="btn-primary"
            [class.active]="formData.type === 'deposito'"
            (click)="formData.type = 'deposito'">
            Depósito
          </button>

          <button
            type="button"
            class="btn-primary"
            [class.active]="formData.type === 'saque'"
            (click)="formData.type = 'saque'">
            Saque
          </button>

          <button
            type="button"
            class="btn-primary"
            [class.active]="formData.type === 'pix'"
            (click)="formData.type = 'pix'">
            PIX
          </button>
        </div>
      </section>

      @if (formData.type === 'deposito') {
        <section class="transaction-section">
          <h4>Dados do depósito</h4>
          <div class="form-group">
            <label>Valor do depósito (R$)</label>
            <input
              type="number"
              class="input-control"
              [ngModel]="formData.value"
              [ngModelOptions]="{standalone: true}"
              (ngModelChange)="formData.value = $event"
              min="0.01"
              step="0.01"
              placeholder="0,00" />
          </div>
        </section>
      }

      @if (formData.type === 'saque') {
        <section class="transaction-section">
          <h4>Dados do saque</h4>
          <div class="form-group">
            <label>Valor do saque (R$)</label>
            <input
              type="number"
              class="input-control"
              [ngModel]="formData.value"
              [ngModelOptions]="{standalone: true}"
              (ngModelChange)="formData.value = $event"
              min="0.01"
              step="0.01"
              placeholder="0,00" />
          </div>
        </section>
      }

      @if (formData.type === 'pix') {
        <section class="transaction-section">
          <h4>Dados do PIX</h4>
          <div class="form-group">
            <label>Chave PIX do destinatário</label>
            <input
              type="text"
              class="input-control"
              [ngModel]="formData.pixKey"
              [ngModelOptions]="{standalone: true}"
              (ngModelChange)="formData.pixKey = $event; checkPixKey()"
              placeholder="E-mail, CPF ou chave cadastrada" />
            @if (recipientInfo && recipientInfo.found) {
              <p class="hint success-hint">
                Enviando para: {{ recipientInfo.name }}
              </p>
            } @else if (recipientInfo && !recipientInfo.found && formData.pixKey && formData.pixKey.length > 3) {
              <p class="hint error-hint">
                Chave PIX não encontrada
              </p>
            }
          </div>

          <div class="form-group">
            <label>Valor do PIX (R$)</label>
            <input
              type="number"
              class="input-control"
              [ngModel]="formData.value"
              [ngModelOptions]="{standalone: true}"
              (ngModelChange)="formData.value = $event"
              min="0.01"
              step="0.01"
              placeholder="0,00" />
          </div>
        </section>
      }

      @if (formData.type) {
        <section class="transaction-section">
          <h4>Descrição</h4>
          <div class="form-group">
            <label>
              {{ formData.type === 'pix' ? 'Mensagem (opcional)' : 'Descrição (opcional)' }}
            </label>
            <input
              type="text"
              class="input-control"
              [ngModel]="formData.description"
              [ngModelOptions]="{standalone: true}"
              (ngModelChange)="formData.description = $event"
              [placeholder]="formData.type === 'pix' ? 'Mensagem para o destinatário' : 'Descrição da transação'" />
          </div>
        </section>
      }

      @if (formData.type) {
        <div class="transaction-actions">
          <button
            class="btn-primary w-full"
            [disabled]="isLoading"
            (click)="processTransaction()">
            @if (!isLoading) {
              <span>
                {{
                  formData.type === 'deposito' ? 'Confirmar depósito' :
                  formData.type === 'saque' ? 'Confirmar saque' :
                  'Enviar PIX'
                }}
              </span>
            } @else {
              <span>Processando...</span>
            }
          </button>
        </div>
      }

    </div>
  </div>

  <footer class="bottom-nav">
    <a routerLink="/home" routerLinkActive="active" class="nav-item">
      <img src="/home.png" alt="Home">
      <span>Home</span>
    </a>
    <a routerLink="/extrato" routerLinkActive="active" class="nav-item">
      <img src="/grafico.png" alt="Statistics">
      <span>Extrato</span>
    </a>
    <a routerLink="/transacoes" routerLinkActive="active" class="nav-item">
      <img src="/carteira.png" alt="Transactions">
      <span>Transações</span>
    </a>
  </footer>
</div>